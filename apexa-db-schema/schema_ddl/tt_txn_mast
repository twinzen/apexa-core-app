CREATE TABLE tt_txn_mast (
	txnid INT UNSIGNED PRIMARY KEY ,
	txn_type_cde VARCHAR (12) NOT NULL ,
	ext_txn_ref VARCHAR (40) NOT NULL ,
	ext_txn_type_cde VARCHAR (20) NOT NULL ,
	acid INT UNSIGNED NOT NULL ,
	secid INT UNSIGNED NOT NULL ,
	trd_dt_tm DATETIME (6) NOT NULL ,
	post_dt_tm DATETIME (6) NOT NULL ,
	exe_prc DECIMAL (19,5) NOT NULL ,
	prc_ccy CHAR (3) NOT NULL ,
	exe_prc_locl DECIMAL (19,5) NOT NULL ,
	qty DECIMAL (19,5) NOT NULL ,
	prip_amt_locl DECIMAL (19,5) NOT NULL ,
	setl_dt_tm DATETIME  ,
	setl_ccy CHAR (3)  ,
	setl_amt_setl DECIMAL (19,5)  ,
	setl_locl_rate_dt_tm DATETIME  ,
	mkt_cde VARCHAR (12) NOT NULL ,
	src_sys_cde VARCHAR (12) NOT NULL ,
	txn_stat INT UNSIGNED NOT NULL ,
	long_sht_ind CHAR (1) NOT NULL ,
	mkt_val_locl DECIMAL (19,5) NOT NULL ,
	mkt_val_acct DECIMAL (19,5)  ,
	mkt_val_base DECIMAL (19,5)  ,
	bk_cost_locl DECIMAL (19,5) NOT NULL ,
	bk_cost_acct DECIMAL (19,5)  ,
	bk_cost_base DECIMAL (19,5)  ,
	ext_lot_ref VARCHAR (40)  ,
	narr_txt VARCHAR (100)  ,
	txn_rmk VARCHAR (12)  ,
	edit_rmk_txt VARCHAR (100)  ,
	edit_staf_id VARCHAR (12)  ,
	tzdb INT  ,
	cnl_ind VARCHAR (1) NOT NULL ,
	cnl_dt_tm DATETIME NOT NULL ,
	crt_dt_tm DATETIME NOT NULL ,
	updt_dt_tm DATETIME NOT NULL 
);

CREATE INDEX x1_txn_mast ON tt_txn_mast (acid, cnl_ind);
CREATE INDEX x2_txn_mast ON tt_txn_mast (ext_txn_ref, trd_dt_tm, cnl_ind);
CREATE UNIQUE INDEX u1_txn_mast ON tt_txn_mast (ext_txn_ref, trd_dt_tm, cnl_ind, cnl_dt_tm);


insert into tt_txn_mast (
txnid,txn_type_cde,ext_txn_ref,ext_txn_type_cde,acid,secid,
trd_dt_tm,
post_dt_tm,
exe_prc,
prc_ccy,
exe_prc_locl,
qty,
prip_amt_locl,
setl_dt_tm,
setl_ccy,
setl_amt_setl,
setl_locl_rate,
setl_locl_rate_dt_tm,
mkt_cde,
src_sys_cde,
txn_stat,
long_sht_ind,
mkt_val_locl,
mkt_val_acct,
bk_cost_locl,
bk_cost_acct,
tzdb,
cnl_ind,
cnl_dt_tm,
crt_dt_tm,
updt_dt_tm
) select 
txn_id,txn_type_cde,ext_txn_ref,ext_txn_type_cde,acid,secid,
exe_dt_tm,
post_dt_tm,
exe_prc,
prc_ccy,
exe_prc,
qty,
prip_amt_locl,
setl_dt_tm,
setl_ccy,
setl_amt_setl,
setl_locl_rate,
exe_dt_tm,
mkt_cde,
src_sys_cde,
1,
long_sht_ind,
mkt_val_locl,
mkt_val_acct,
bk_cost_locl,
bk_cost_acct,
0,
'N',
'3999-12-31',
sysdate(),
sysdate()
from txn_mast where acid > 1 and acid < 20;
